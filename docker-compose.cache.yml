# docker-compose/docker-compose.cache.yml
# ğŸ“¦ Cache Service - Redis by default, but easily configurable for other solutions

services:
  dream_cache:
    # ğŸ¯ Default: Redis (fast, reliable, well-supported)
    # ğŸ”§ Alternatives: valkey/valkey, memcached, keydb/keydb
    image: ${CACHE_IMAGE:-redis:7-alpine}
    container_name: ${PROJECT_NAME:-dream-project}_cache
    
    # âš™ï¸ Cache configuration
    environment:
      # Redis-specific settings (ignored by other cache solutions)
      REDIS_PASSWORD: ${CACHE_PASSWORD:-}
      REDIS_DATABASES: ${CACHE_DATABASES:-16}
      
    # ğŸ’¾ Persistent storage for your caching dreams
    volumes:
      - dream_cache_data:/data
      # Optional: Custom configuration
      # - ./cache/redis.conf:/etc/redis/redis.conf:ro
      
    # ğŸŒ Port mapping (use non-standard port to avoid conflicts)
    ports:
      - "${CACHE_PORT:-6380}:6379"
      
    # ğŸ”— Network connectivity
    networks:
      - dream_network
    
    # ğŸ¥ Health check for reliable connections
    healthcheck:
      test: ["CMD", "redis-cli", "--raw", "incr", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5
      start_period: 10s
    
    # ğŸ”„ Restart policy for reliability
    restart: unless-stopped
    
    # ğŸ“Š Resource limits (caches should be fast and light)
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M
    
    # ğŸš€ Performance optimizations
    command: >
      redis-server
      --maxmemory 256mb
      --maxmemory-policy allkeys-lru
      --save 900 1
      --save 300 10
      --save 60 10000

# ğŸŒ Networks (defined in main docker-compose.yml)
networks:
  dream_network:
    external: true

# ğŸ’¾ Volumes (defined in main docker-compose.yml)
volumes:
  dream_cache_data:
    external: true

# ğŸ“ Alternative Cache Solutions (uncomment to use):
#
# ğŸ”„ Valkey (Redis fork):
# services:
#   dream_cache:
#     image: valkey/valkey:7-alpine
#     # ... same configuration as Redis
#
# ğŸ’¾ Memcached:
# services:
#   dream_cache:
#     image: memcached:1-alpine
#     command: ["memcached", "-m", "256"]
#     ports:
#       - "${CACHE_PORT:-11212}:11211"
#     # No persistent volumes needed for Memcached
#
# âš¡ KeyDB (Multi-threaded Redis):
# services:
#   dream_cache:
#     image: eqalpha/keydb:latest
#     # ... same configuration as Redis